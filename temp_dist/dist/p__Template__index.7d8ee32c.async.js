"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[430],{30392:function(J,U,e){e.r(U),e.d(U,{default:function(){return ne}});var j=e(67294),M=e(90930),G=e(15009),T=e.n(G),W=e(97857),y=e.n(W),N=e(13769),s=e.n(N),a=e(99289),n=e.n(a),v=e(5574),o=e.n(v),c=e(51042),P=e(34603),R=e(55060),$=e(28036),K=e(2453),w=e(37476),V=e(5966),Y=e(59061),H=e(59592),z=e(91122),i=e(85893),k=["id","onSuccess"],q=function(){var g=(0,j.useState)(!0),I=o()(g,2),E=I[0],A=I[1],L=(0,j.useState)(),f=o()(L,2),p=f[0],h=f[1],F=(0,j.useRef)({}),S=(0,j.useCallback)(function(d){n()(T()().mark(function m(){var r,l;return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!d){u.next=8;break}return A(!0),u.next=4,(0,z.l3)(d).finally(function(){return A(!1)});case 4:r=u.sent,r?(l={templateName:r.templateName,brandName:r.brandName,bgImg:[{url:r.bgImgUrl}],shareImg:[{url:r.shareImgUrl}]},h(l)):(F.current={},h(void 0)),u.next=9;break;case 8:A(!1);case 9:case"end":return u.stop()}},m)}))()},[]);return{loading:E,detail:p,loadTemplateDetail:S,wxJumpParamsRef:F}},_=function(g){var I=g.id,E=g.onSuccess,A=s()(g,k),L=(0,j.useMemo)(function(){var d=!!I;return{isEdit:d,title:d?"\u7F16\u8F91\u6A21\u677F":"\u65B0\u5EFA\u6A21\u677F"}},[I]),f=q(),p=f.loading,h=f.detail,F=f.loadTemplateDetail,S=f.wxJumpParamsRef;return(0,i.jsxs)(w.Y,y()(y()({title:L.title,width:520,layout:"horizontal",labelCol:{span:5},wrapperCol:{span:18},initialValues:h,modalProps:{loading:p,destroyOnClose:!0,maskClosable:!1},onOpenChange:function(m){m&&F(I)},onFinish:function(){var d=n()(T()().mark(function m(r){var l,t,u,C,Z,x,O,B;return T()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(Z=r.templateName||"",x=r.brandName||"",O=((l=r.shareImg)===null||l===void 0||(l=l[0])===null||l===void 0||(l=l.response)===null||l===void 0?void 0:l.url)||((t=r.shareImg)===null||t===void 0||(t=t[0])===null||t===void 0?void 0:t.url)||"",B=((u=r.bgImg)===null||u===void 0||(u=u[0])===null||u===void 0||(u=u.response)===null||u===void 0?void 0:u.url)||((C=r.bgImg)===null||C===void 0||(C=C[0])===null||C===void 0?void 0:C.url)||"",!L.isEdit){b.next=10;break}return b.next=7,(0,z.Gi)({id:I,templateName:Z,brandName:x,bgImgUrl:B,shareImgUrl:O});case 7:K.ZP.success("\u7F16\u8F91\u6A21\u677F\u6210\u529F"),b.next=13;break;case 10:return b.next=12,(0,z.WF)({templateName:Z,brandName:x,bgImgUrl:B,shareImgUrl:O});case 12:K.ZP.success("\u65B0\u5EFA\u6A21\u677F\u6210\u529F");case 13:return E==null||E(),b.abrupt("return",!0);case 15:case"end":return b.stop()}},m)}));return function(m){return d.apply(this,arguments)}}()},A),{},{children:[(0,i.jsx)(V.Z,{name:"templateName",label:"\u6A21\u677F\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},{max:20,message:"\u6A21\u677F\u540D\u79F0\u957F\u5EA6\u4E0D\u8D85\u8FC720"}]}),(0,i.jsx)(V.Z,{name:"brandName",label:"\u54C1\u724C\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0"},{max:20,message:"\u54C1\u724C\u540D\u79F0\u957F\u5EA6\u4E0D\u8D85\u8FC720"}]}),(0,i.jsx)(Y.Z,{name:"shareImg",label:"\u5206\u4EAB\u56FE",placeholder:"\u8BF7\u4E0A\u4F20\u5206\u4EAB\u56FE",max:1,required:!0,fieldProps:{name:"file",listType:"picture-card",accept:".jpg,.jpeg,.png",customRequest:function(m){return(0,H.$)("/api/sys/file/uploadTemplateFile",m)}},extra:"\u652F\u6301\u6587\u4EF6\u683C\u5F0F\uFF1A.jpg,.jpeg,.png",rules:[{validator:function(m,r){if(r&&Array.isArray(r)&&r.length===1){var l=o()(r,1),t=l[0];return t.error?Promise.reject(t.error.message):t.status==="uploading"?Promise.reject("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6..."):t.status==="done"&&!t.response?Promise.reject("\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"):Promise.resolve()}return Promise.reject("\u8BF7\u4E0A\u4F20\u5206\u4EAB\u56FE")}}]}),(0,i.jsx)(Y.Z,{name:"bgImg",label:"\u80CC\u666F\u56FE",placeholder:"\u8BF7\u4E0A\u4F20\u5C0F\u7A0B\u5E8F\u80CC\u666F\u56FE",max:1,required:!0,fieldProps:{name:"file",listType:"picture-card",accept:".jpg,.jpeg,.png,.gif",customRequest:function(m){return(0,H.$)("/api/sys/file/uploadTemplateFile",m)}},extra:"\u652F\u6301\u6587\u4EF6\u683C\u5F0F\uFF1A.jpg,.jpeg,.png,.gif",rules:[{validator:function(m,r){if(r&&Array.isArray(r)&&r.length===1){var l=o()(r,1),t=l[0];return t.error?Promise.reject(t.error.message):t.status==="uploading"?Promise.reject("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6..."):t.status==="done"&&!t.response?Promise.reject("\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"):Promise.resolve()}return Promise.reject("\u8BF7\u4E0A\u4F20\u5C0F\u7A0B\u5E8F\u80CC\u666F\u56FE")}}]})]}))},Q=_,ee=["current","pageSize"],re=function(){var g=(0,j.useRef)(),I=(0,j.useState)(),E=o()(I,2),A=E[0],L=E[1];return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(P.Z,{rowKey:"id",actionRef:g,search:!1,request:function(){var f=n()(T()().mark(function p(h){var F,S,d,m,r,l,t,u,C;return T()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return F=h.current,S=F===void 0?1:F,d=h.pageSize,m=d===void 0?10:d,r=s()(h,ee),x.next=3,(0,z.A8)(y()(y()({},r),{},{pageSize:m,pageNum:S}));case 3:return l=x.sent,t=l||{},u=t.list,C=t.total,x.abrupt("return",{success:!0,data:(u||[]).map(function(O){var B=y()({},O||{});return y()({},O)}),total:C||0});case 6:case"end":return x.stop()}},p)}));return function(p){return f.apply(this,arguments)}}(),columns:[{dataIndex:"templateName",title:"\u6A21\u677F\u540D\u79F0"},{dataIndex:"brandName",title:"\u54C1\u724C\u540D\u79F0"},{dataIndex:"shareImgUrl",title:"\u5206\u4EAB\u56FE",renderText:function(p){return(0,i.jsx)(R.Z,{src:p,height:80})}},{dataIndex:"bgImgUrl",title:"\u80CC\u666F\u56FE",renderText:function(p){return(0,i.jsx)(R.Z,{src:p,height:80})}},{dataIndex:"id",title:"\u64CD\u4F5C",width:260,renderText:function(p,h){return(0,i.jsx)("div",{children:(0,i.jsx)(Q,{id:A,onSuccess:function(){var S;g==null||(S=g.current)===null||S===void 0||S.reload()},trigger:(0,i.jsx)($.ZP,{type:"link",onClick:function(){L(p)},children:"\u7F16\u8F91"})})})}}],toolBarRender:function(){return[(0,i.jsx)(Q,{onSuccess:function(){var h;g==null||(h=g.current)===null||h===void 0||h.reload()},trigger:(0,i.jsx)($.ZP,{type:"primary",icon:(0,i.jsx)(c.Z,{}),children:"\u65B0\u5EFA"})},"addTemplate")]}})})},te=re,X=function(D){return D.COLLECTION_LIST="COLLECTION_LIST",D}(X||{}),ae=function(){return(0,i.jsx)(M._z,{tabList:[{key:X.COLLECTION_LIST,tab:"\u6A21\u677F\u7BA1\u7406",children:(0,i.jsx)(te,{})}],tabProps:{destroyInactiveTabPane:!0}})},ne=ae},59592:function(J,U,e){e.d(U,{$:function(){return M},v:function(){return W}});var j=e(91122),M=function(N,s){var a=s.file,n=s.onSuccess,v=s.onProgress,o=s.onError;(0,j.cT)(N,a,{onUploadProgress:function(P){var R=P.total,$=P.loaded;v==null||v({percent:Number(Math.round($/R*100).toFixed(2))||0})}}).then(function(c){var P=c||{},R=P.url,$=P.dimensions;n==null||n({url:R,dimensions:$})}).catch(function(c){o==null||o(c)})},G=e(97857),T=e.n(G),W=function(N){var s={position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}};if(typeof N=="string"&&N)try{var a=JSON.parse(N);["position","rotation"].forEach(function(n){var v,o,c;s[n].x=(a==null||(v=a[n])===null||v===void 0?void 0:v.x)||0,s[n].y=(a==null||(o=a[n])===null||o===void 0?void 0:o.y)||0,s[n].z=(a==null||(c=a[n])===null||c===void 0?void 0:c.z)||0}),["scale"].forEach(function(n){var v,o,c;s[n].x=(a==null||(v=a[n])===null||v===void 0?void 0:v.x)||1,s[n].y=(a==null||(o=a[n])===null||o===void 0?void 0:o.y)||1,s[n].z=(a==null||(c=a[n])===null||c===void 0?void 0:c.z)||1})}catch(n){}return{position:T()({},s.position),rotation:T()({},s.rotation),scale:T()({},s.scale)}}}}]);
